<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>الرئيسية - جاكرو</title>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0;
      height: 100vh;
      display: flex;
      background: #f7f9fc;
    }
    .sidebar {
      width: 250px;
      background: #2c3e50;
      color: white;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .sidebar button {
      width: 90%;
      padding: 15px;
      margin: 10px 0;
      background: #3498db;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    .sidebar button:hover {
      background: #2980b9;
    }
    .logout {
      background: #e74c3c;
    }
    .logout:hover {
      background: #c0392b;
    }
    .main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      flex-direction: column;
      padding: 40px;
    }
    .results-box, .vote-box {
      background: white;
      padding: 30px;
      margin-bottom: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      width: 90%;
      max-width: 600px;
      text-align: center;
    }
    h1, h2 {
      color: #34495e;
    }
    .vote-count {
      font-size: 32px;
      margin: 15px 0;
      color: #27ae60;
    }
    select, button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: #3498db;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #2980b9;
    }
  </style>
</head>
<body>

<div class="sidebar">
  <button onclick="showStats()">عرض الإحصائيات</button>
  <button class="logout" onclick="logout()">تسجيل الخروج</button>
</div>

<div class="main">

  <!-- صندوق النتيجة -->
  <div class="results-box">
    <h1>نتيجة اليوم</h1>
    <div id="todayResults">
      <!-- عرض النتائج -->
    </div>
    <div class="vote-count" id="liveCounter">
      0 تصويت
    </div>
  </div>

  <!-- صندوق التصويت -->
  <div class="vote-box">
    <h2>صوّت الآن</h2>
    <label>اختر الجولة</label>
    <select id="round">
      <option value="1">جولة ١</option>
      <option value="2">جولة ٢</option>
      <option value="3">جولة ٣</option>
      <option value="4">جولة ٤</option>
    </select>

    <label>اختيار لاعب ١</label>
    <select id="player1"></select>

    <label>اختيار لاعب ٢</label>
    <select id="player2"></select>

    <button onclick="submitVote()">إرسال التصويت</button>
  </div>

</div>

<script>
const players = ['يحيى', 'محمود', 'سلطان', 'محمد', 'عبدو', 'حسن'];

const playerSelects = [document.getElementById('player1'), document.getElementById('player2')];
playerSelects.forEach(select => {
    players.forEach(player => {
        const opt = document.createElement('option');
        opt.value = player;
        opt.textContent = player;
        select.appendChild(opt);
    });
});

function submitVote() {
    const round = document.getElementById('round').value;
    const p1 = document.getElementById('player1').value;
    const p2 = document.getElementById('player2').value;
    const currentUser = JSON.parse(localStorage.getItem('currentUser')).user;
    const votes = JSON.parse(localStorage.getItem('votes') || '{}');

    if (p1 === p2) {
        alert('لا يمكنك اختيار نفس اللاعب مرتين.');
        return;
    }

    if (!votes[round]) votes[round] = [];

    // تحقق اذا المستخدم صوّت بالفعل على هذه الجولة
    const alreadyVoted = votes[round].some(vote => vote.user === currentUser);
    if (alreadyVoted) {
        alert('لقد قمت بالتصويت مسبقاً على هذه الجولة.');
        return;
    }

    votes[round].push({user: currentUser, players: [p1, p2]});
    localStorage.setItem('votes', JSON.stringify(votes));
    alert('تم تسجيل تصويتك');
    updateResults();
}

function updateResults() {
    const todayResultsDiv = document.getElementById('todayResults');
    const liveCounterDiv = document.getElementById('liveCounter');
    const votes = JSON.parse(localStorage.getItem('votes') || '{}');
    let totalVotes = 0;
    const roundWinners = {};

    todayResultsDiv.innerHTML = '';

    for (const round in votes) {
        const roundVotes = votes[round];
        const pairCount = {};

        roundVotes.forEach(vote => {
            const sortedPair = vote.players.slice().sort();
            const key = sortedPair.join('-');
            pairCount[key] = (pairCount[key] || 0) + 1;
        });

        // التحقق من الأزواج يلي حصلوا على ٣ أصوات أو أكثر
        for (const pair in pairCount) {
            if (pairCount[pair] >= 3) {
                roundWinners[round] = pair;
            }
        }

        totalVotes += roundVotes.length;
    }

    if (Object.keys(roundWinners).length > 0) {
        todayResultsDiv.innerHTML = '';
        for (const round in roundWinners) {
            todayResultsDiv.innerHTML += `<h2>جولة ${round}: ${roundWinners[round].replace('-', ' و ')}</h2>`;
        }
    } else {
        todayResultsDiv.innerHTML = `<h2>لا توجد نتائج كافية بعد</h2>`;
    }

    liveCounterDiv.textContent = `${totalVotes} تصويت`;
}

function showStats() {
    window.location.href = 'stats.html';
}

function logout() {
    localStorage.removeItem('currentUser');
    window.location.href = 'login.html';
}

// تحديث النتائج لايف كل ٣ ثواني
setInterval(updateResults, 3000);

// أول تحميل للنتائج
updateResults();
</script>


</body>
</html>
